(function(){function l(n=""){$.ajax({url:`${domainUrl}/api/GetAreas/0`,method:"GET",dataType:"text",async:!0}).done(function(t){var i=JSON.parse(t),r=JSON.parse(textLocalised);$("#selectParentArea").empty();$("#selectParentArea").append(`<option value="" disabled></option>`);$.each(i,function(t,i){var r=contains(n,i.Value)?"selected":"";$("#selectParentArea").append(`<option value="${i.Value}" ${r}>${i.Text}</option>`)})}).fail(function(){})}function u(n,t=""){var i=$(`#${n}`).find("option").clone(),r;$(`#${n}`).empty();for(let u=0;u<i.length;u++)r=i[u].value==t?"selected":"",$(`#${n}`).append(`<option value="${i[u].value}" ${r}>${i[u].innerText}</option>`)}function f(n=[]){$.ajax({url:`${domainUrl}/api/Types/${$("#selectType").find(":selected").val()}`,method:"GET",dataType:"text"}).done(function(t){var i=JSON.parse(t),r=JSON.parse(textLocalised);$("#selectSubType").empty();$("#selectSubType").append(`<option value="" disabled>${r.subType}</option>`);$.each(i,function(t,i){var r=contains(n,i.Value)?"selected":"";$("#selectSubType").append(`<option value="${i.Value}" ${r}>${i.Text}</option>`)})}).fail(function(){})}function e(n=[]){$.ajax({url:`${domainUrl}/api/GetAreas/${$("#selectParentArea").find(":selected").val()}`,method:"GET",dataType:"text",async:!0}).done(function(t){var i=JSON.parse(t),r=JSON.parse(textLocalised);$("#selectArea").empty();$("#selectArea").append(`<option value="" disabled>${r.subArea}</option>`);$.each(i,function(t,i){var r=contains(n,i.Value)?"selected":"";$("#selectArea").append(`<option value="${i.Value}" ${r}>${i.Text}</option>`)})}).fail(function(){})}function a(){var t=decodeURIComponent($("form#searchDataForm").serialize()),n=`${domainUrl}/Home/Search/?${t}`;o!=n&&(o=n,window.history.pushState({path:n},"",n))}function s(){const n=Array.from($("[filter]")).map(n=>n.attributes.filter.value),t={};n.forEach(n=>{t[n]=decodeURIComponent(gup(n));let i=decodeURIComponent(gup(n)),r=getUrlParameter(n);$(`select[${n}]`).each(function(){if($(this).parent().attr("id")=="selectType")u($(this).parent().attr("id"),i);else if($(this).parent().attr("id")=="selectParentArea")l(i);else if($(this).parent().attr("id")=="inp_Category")u($(this).parent().attr("id"),i);else if($(this).parent().attr("id")=="EnergyEfficiency")u($(this).parent().attr("id"),i);else if($(this).attr("id")=="selectSubType")f(r);else if($(this).attr("id")=="selectArea")e(r);else var n=r});$(`input[type="checkbox"][${n}]`).each(function(){i=="on"?$(this).prop("checked",!0).change():$(this).prop("checked",!1).change()});$(`input[type="number"][${n}]`).val(i)})}function i(n){var t=$("form").serialize();$.ajax({type:"POST",url:n,data:t}).done(function(n){var t=JSON.parse(n);h(t);$(".details-heart").unbind("click");$(".details-heart").click(function(n){var t=$(this).data("postid");$(this).hasClass("details-wish")?$.ajax({url:domainUrl+"/Posts/Details/WishList/"+t,method:"GET",dataType:"text"}).done(function(){$(`a.details-heart[data-postid="${t}"]`).removeClass("details-wish").addClass("details-unwish");$(`a.details-heart[data-postid="${t}"]`).find(".fa-heart").removeClass("far").addClass("fas")}).fail(function(n){n.status==401&&(window.location.href=domainUrl+"/Identity/Account/Login?ReturnUrl=%2FHome%2FSearch%2F")}):$.ajax({url:domainUrl+"/Posts/Details/UnWishList/"+t,method:"GET",dataType:"text"}).done(function(){$(`a.details-heart[data-postid="${t}"]`).removeClass("details-unwish").addClass("details-wish");$(`a.details-heart[data-postid="${t}"]`).find(".fa-heart").removeClass("fas").addClass("far")}).fail(function(){});n.preventDefault()})}).fail(function(){console.log("error");$("#loader").css("display","none");h([])})}function h(n){n.length>0&&$(`#countOfAds`).html(n[0].CountOfPost);const t=n.length===0?``:n.map(n=>v(n)).join("\n");$("#products").append(t)}function v(n){return`
<div class="col-sm-12 col-md-3 mb-3">
    <div class="card promoting-card m-2">
        <a href="/Posts/Details/${n.Id}">
            <div class="d-flex flex-row m-1" style="white-space: nowrap; overflow: hidden;">
                <span class="badge rounded-pill bg-primary"> ${$.i18n(n.Category)}</span> ${n.Title||""} ${n.Premium}
            </div>
        </a>
        <div class="bg-image hover-overlay hover-zoom hover-shadow ripple">
            <img class="card-img-top rounded-0" src="${n.UrlImage||"/images/DefaultImage1.jpg"}" alt="Card image cap">
            <a href="/Posts/Details/${n.Id}">
                <div class="mask" style="background:rgba(75, 75, 75, 0.35);">
                    <span class="text-default btn-sm" style="position: absolute; top: 0px; left: 0px;">
                        # ${n.Id}
                    </span>
                    <span class="badge rounded-pill bg-primary" style="position: absolute; bottom: 10px; right: 10px;">
                        ${moment(n.CreatedDate).format("L")} <i class="fas fa-clock"></i>
                    </span>
                </div>
            </a>
        </div>
        <div class="card-body d-flex px-2 py-1 form-check-label">
            <span class="p-0 pt-2">
                ${n.CurrencyConvertedLocal} - ${formatMoney(n.Square,0,",",".")||""}  <b>m<sup>2</sup></b> - ${n.ConstructionYear||""} <i class="fas fa-home"></i>
            </span>
            <a type="button" href="#!" data-postid="${n.Id}" class="details-heart ${n.WishList==!0?"details-unwish":"details-wish"} btn-sm ml-auto pb-0 justify-content-end">
                <i class="${n.WishList==!0?"fas":"far"} fa-heart fa-1x pink-text"></i>
            </a>
        </div>
    </div>
</div> `}var o="",n=!1,r=document.querySelector("#infinite-list");const t="/Home/Query",c="/Home/SaveQuery";$(function(){if($("#getId").val()!=undefined){$saveButton=$("<a/>").attr({type:"button",id:"btnModalSearch","class":"btn-sm btn-primary white-text z-depth-1"});$saveButton.html("Αποθήκευση Αναζήτησης");$saveButton.attr("data-toggle","modal");$saveButton.attr("data-target","#modalLoginAvatar");$(".custom-buttons").append($saveButton);$("#btnSaveQuery").on("click",function(){var n=$("form").serialize(),t=$("#searchTitle").val()||"Search Title";$.ajax({type:"POST",url:`${c}/${t}`,data:n}).done(function(){$("#modalLoginAvatar").modal("hide");toastr.success("Η Αναζήτηση αποθηκεύτηκε.")}).fail(function(){$("#modalLoginAvatar").modal("hide");toastr.error("Κάτι πήγε στραβά. Θα το κοιτάξουμε αμέσως.")})})}$(window).on("popstate",function(){n=!0;s();$("#numberOfPage").val("1");i(t);n=!1});let r=JSON.parse(searchData);$("#inp_Category").find("option").each(function(){$(this).removeAttr("selected")});$('#inp_Category option[value="'+r.SaleCategory+'"]').attr("selected","selected").change();$("#selectType").find("option").each(function(){$(this).removeAttr("selected")});$('#selectType option[value="'+r.TypeDesc+'"]').attr("selected","selected").change();f();e();n=!0;s();$("#numberOfPage").val("1");i(t);n=!1});$(function(){$("#loader").css("display","none");$("#sort").change(()=>{$(`#SortList`).val($("#sort").find(":selected").val()),$("#numberOfPage").val("1"),$("#products").empty(),i(t)});$(".filter-option").change(r=>{r.stopImmediatePropagation(),$("#numberOfPage").val("1"),$("#products").empty(),r.target.id=="selectType"&&f(),r.target.id=="selectParentArea"&&e(),n||a(),i(t)})});r.addEventListener("scroll",function(){if(r.scrollTop+r.clientHeight>=r.scrollHeight){let n=parseInt($("#numberOfPage").val())+1;$("#numberOfPage").val(n);i(t);console.log("Bottom - Time to refresh")}})})();